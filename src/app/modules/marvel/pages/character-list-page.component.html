<!-- Messages -->
<p-toast></p-toast>
<p-confirmPopup></p-confirmPopup>

<div class="p-5">
  <p-table
    *ngIf="characters"
    #characterTable
    [value]="characters"
    [columns]="cols"
    [rows]="10"
    [showCurrentPageReport]="true"
    [paginator]="true"
    [scrollable]="true"
    [style]="{ width: '100%' }"
    styleClass="p-datatable-sm"
    [rowsPerPageOptions]="[10, 20, 40]"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} characters"
    dataKey="id"
    [globalFilterFields]="['id', 'name', 'description']"
  >
    <ng-template pTemplate="caption">
      <h4 class="pb-2 fw-bold">Marvel Characters</h4>
      <div class="row">
        <div class="col-lg-4 col-md-8 col-sm-12">
          <input
            #search
            class="form-control"
            type="search"
            pInputText
            placeholder="Buscar ..."
            (input)="handleFilter($event, characterTable)"
          />
        </div>

        <div class="col">
          <button
            pButton
            pRipple
            type="button"
            label="Add character"
            class="p-button-text p-button-rounded mx-2"
            style="font-weight: 600"
            (click)="openDetailModal('add')"
          ></button>
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-file-excel"
            class="p-button-rounded p-button-text p-button-success mx-4 font-xl"
            pTooltip="Export to Excel"
            tooltipPosition="bottom"
            (click)="characterTable.exportCSV()"
          ></button>
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th
          *ngFor="let col of cols"
          [pSortableColumn]="col.field"
          class="text-center"
        >
          {{ col.header }}
        </th>
        <th></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-character>
      <tr [pSelectableRow]="character">
        <td *ngFor="let col of cols" class="text-center">
          {{ character[col.field] }}
        </td>

        <td class="d-flex justify-content-end">
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-eye"
            class="p-button-rounded p-button-text mx-2"
            pTooltip="View Character"
            tooltipPosition="bottom"
            (click)="
              openDetailModal('view', character);
              $event.stopImmediatePropagation();
              $event.preventDefault()
            "
          ></button>
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-pencil"
            class="p-button-rounded p-button-text mx-2"
            pTooltip="Edit Character"
            tooltipPosition="bottom"
            (click)="
              openDetailModal('edit', character);
              $event.stopImmediatePropagation();
              $event.preventDefault()
            "
          ></button>
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-trash"
            class="p-button-rounded p-button-text mx-2 text-danger"
            pTooltip="Remove Character"
            tooltipPosition="bottom"
            (click)="
              removeCharacter($event, character);
              $event.stopImmediatePropagation();
              $event.preventDefault()
            "
          ></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td [attr.colspan]="'5'">No se han obtenido resultados</td>
      </tr>
    </ng-template>
  </p-table>
</div>
